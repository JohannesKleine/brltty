#!/bin/bash
. /brltty/current/libexec/canute-prologue.sh

declare -A cursorStyles=(
   [block]=12345678
   [underline]=78
   [left]=7
   [right]=8
)

showProgramUsagePurpose() {
cat <<END_OF_PROGRAM_USAGE_PURPOSE
Manage how the cursor is rendered on the Canute's braille display.
END_OF_PROGRAM_USAGE_PURPOSE
}

showProgramUsageNotes() {
cat <<END_OF_PROGRAM_USAGE_NOTES
END_OF_PROGRAM_USAGE_NOTES
}

optionalProgramParameters
addProgramParameter "cursor-style" styleName "the cursor style to switch to (${!cursorStyles[*]})"
parseProgramArguments "${@}"
set -e

if [ -n "${styleName}" ]
then
   verifyChoice "cursor style" styleName "${!cursorStyles[@]}"
   styleDots="${cursorStyles["${styleName}"]}"
   canute-parameter cursor-dots "${styleDots}"
else
   styleDots="$(canute-parameter cursor-dots)"
   styleName=""

   for name in "${!cursorStyles[@]}"
   do
      if [ "${styleDots}" = "${cursorStyles["${name}"]}" ]
      then
         styleName="${name}"
         break
      fi
   done

   [ -n "${styleName}" ] || semanticError "unrecognized dot combination: ${styleDots}"
   echo "${styleName}"
fi

exit 0
