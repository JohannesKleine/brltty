#!/bin/bash
. /brltty/current/libexec/canute-prologue.sh

declare -A cursorStyles=(
   [underline]=78
   [block]=12345678
   [left]=7
   [right]=8
   [hide]=0
)

showProgramUsagePurpose() {
cat <<END_OF_PROGRAM_USAGE_PURPOSE
Manage how the cursor is rendered on the Canute's braille display.
END_OF_PROGRAM_USAGE_PURPOSE
}

showProgramUsageNotes() {
cat <<END_OF_PROGRAM_USAGE_NOTES
If the parameter isn't specified then the name of the current cursor style is shown.
END_OF_PROGRAM_USAGE_NOTES
}

optionalProgramParameters
addProgramParameter "cursor-style" styleName "the name of the cursor style to switch to (${!cursorStyles[*]})"
parseProgramArguments "${@}"
set -e

if [ -n "${styleName}" ]
then
   verifyChoice "cursor style" styleName "${!cursorStyles[@]}"
   styleDots="${cursorStyles["${styleName}"]}"
   "${programDirectory}/canute-parameter" -g cursor-dots "${styleDots}"
else
   styleDots="$("${programDirectory}/canute-parameter" -g cursor-dots)"
   styleName=""

   for name in "${!cursorStyles[@]}"
   do
      if [ "${styleDots}" = "${cursorStyles["${name}"]}" ]
      then
         styleName="${name}"
         break
      fi
   done

   [ -n "${styleName}" ] || semanticError "unrecognized dot combination: ${styleDots}"
   echo "${styleName}"
fi

exit 0
