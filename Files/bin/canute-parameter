#!/bin/bash
. /brltty/current/libexec/canute-prologue.sh

showProgramUsagePurpose() {
cat <<END_OF_PROGRAM_USAGE_PURPOSE
Show or set the values of BrlAPI parameters.
END_OF_PROGRAM_USAGE_PURPOSE
}

showProgramUsageNotes() {
cat <<END_OF_PROGRAM_USAGE_NOTES
If the parameter's name isn't specified then all the parameters are listed.
If just a name is specified then only that parameter's value is shown.
If a value is also specified then it's assigned to the named parameter.
END_OF_PROGRAM_USAGE_NOTES
}

addProgramOption g flag isGlobalParameter "the parameter is global"
optionalProgramParameters
addProgramParameter "name" apiParameter "the name of a BrlAPI parameter"
addProgramParameter "value" newValue "the new value to assign to the parameter"
parseProgramArguments "${@}"

apiCommand() {
   local command="${1}"
   shift 1

   "${programDirectory}/canute-apitool" "${command}" -server "localhost:${session}" "${@}"
   return "${?}"
}

session=0
"${isGlobalParameter}" || [ -z "${DISPLAY}" ] || session=1

if [ -n "${newValue}" ]
then
   apiCommand set-parameter "${apiParameter}" "${newValue}"
   returnCode="${?}"
elif [ -n "${apiParameter}" ]
then
   apiCommand list-parameter "${apiParameter}"
   returnCode="${?}"
else
   apiCommand list-parameters
   returnCode="${?}"
fi

exit "${returnCode}"
