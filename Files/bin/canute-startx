#!/bin/bash
. /brltty/current/libexec/prologue.sh

defaultLogFile="/tmp/${programName}.log"
defaultSessionScript="${installTree}/libexec/canute-xsession"

addTestModeOption
addProgramOption l string.file logFile "the log file" "${defaultLogFile}"
addProgramOption s string.file sessionScript "the X session script" "${defaultSessionScript}"
addProgramOption n flag noMonitor "no monitor - use a virtual X display"
parseProgramArguments "${@}"

[ -n "${logFile}" ] || logFile="${defaultLogFile}"
verifyOutputFile "${logFile}"

[ -n "${sessionScript}" ] || sessionScript="${defaultSessionScript}"
verifyExecutableFile "${sessionScript}"

"${testMode}" || exec &> "${logFile}"
startxCommand=(startx "${sessionScript}")

"${noMonitor}" && {
   verifyHostCommand xorgPath Xorg
   startxCommand+=(-- "${xorgPath}")
   startxCommand+=(-config "${installTree}/etc/xorg-dummy-1920x1080.conf")
   [ -n "${XDG_VTNR}" ] && export WINDOWPATH="${XDG_VTNR}"
}

executeHostCommand exec "${startxCommand[@]}"
exit "${?}"
