#!/bin/bash

installTree="/brltty/current"
. "${installTree}/bin/brltty-prologue.sh"

defaultLogFile="/tmp/${programName}.log"
defaultSessionScript="${installTree}/libexec/canute-xsession"

addProgramOption l string.file logFile "the log file" "${defaultLogFile}"
addProgramOption s string.file sessionScript "the X session script" "${defaultSessionScript}"
addProgramOption n flag noMonitor "no monitor - use a virtual X display"
parseProgramArguments "${@}"

[ -n "${logFile}" ] || logFile="${defaultLogFile}"
verifyOutputFile "${logFile}"

[ -n "${sessionScript}" ] || sessionScript="${defaultSessionScript}"
verifyExecutableFile "${sessionScript}"

exec &> "${logFile}"
set -- startx "${sessionScript}"

"${noMonitor}" && {
   set -- "${@}" -- /usr/bin/Xorg -config "/etc/xorg-dummy-1920x1080.conf"
   [ -n "${XDG_VTNR}" ] && export WINDOWPATH="${XDG_VTNR}"
}

exec "${@}"
exit "${?}"
